<!doctype html>
<html class="docs-version-V1" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.15">
<title data-react-helmet="true">How it works | Semaphore</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://semaphore.appliedzkp.org//docs/V1/howitworks"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="V1"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-V1"><meta data-react-helmet="true" property="og:title" content="How it works | Semaphore"><meta data-react-helmet="true" name="description" content="Inserting identities"><meta data-react-helmet="true" property="og:description" content="Inserting identities"><link data-react-helmet="true" rel="icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://semaphore.appliedzkp.org//docs/V1/howitworks"><link data-react-helmet="true" rel="alternate" href="https://semaphore.appliedzkp.org//docs/V1/howitworks" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://semaphore.appliedzkp.org//docs/V1/howitworks" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.89283e7c.css">
<link rel="preload" href="/assets/js/runtime~main.b7f259fa.js" as="script">
<link rel="preload" href="/assets/js/main.173807db.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?t("light"):t("dark")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#DAE0FF;color:#000000" role="banner"><div class="announcementBarPlaceholder_NC_W"></div><div class="announcementBarContent_KsVm"><b>The Semaphore V2 <a target="_blank" rel="noopener noreferrer" href="https://storage.googleapis.com/trustedsetup-a86f4.appspot.com/semaphore/semaphore_top_index.html">trusted-setup ceremony</a> ended successfully with more than 300 contributors! ðŸŽ‰</b></div><button type="button" class="clean-btn close announcementBarClose_FG1z" aria-label="Close"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/semaphore-logo.svg" alt="Semaphore Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/semaphore-logo.svg" alt="Semaphore Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div><div class="navbar__items navbar__items--right"><a href="https://semaphore.appliedzkp.org/whitepaper-v1.pdf" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link V1_active V1 docs">Whitepaper</a><a class="navbar__item navbar__link persistent V1 docs" href="/docs/introduction">Documentation</a><a href="https://github.com/semaphore-protocol" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link persistent V1 docs"><span>Github<span style="margin-left:0.6rem;position:relative;top:1px"><svg class="custom-icon" width="13" height="13" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M5.85868 0.495117L5.85398 2.49512L10.4116 2.50578L0.808105 12.09L2.2209 13.5056L11.8507 3.89516L11.8399 8.50917L13.8399 8.51377L13.8587 0.513817L5.85868 0.495117Z"></path></svg></span></span></a><div class="toggle_Vdj9 toggle_TdHA toggleChecked_efXD toggleDisabled_VOAz"><div class="toggleTrack_a1Re" role="button" tabindex="-1"><div class="toggleTrackCheck_LppO"><span class="toggleIcon_kMo0"><svg class="custom-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.2256 2.00253C9.59172 1.94346 6.93894 2.9189 4.92893 4.92891C1.02369 8.83415 1.02369 15.1658 4.92893 19.071C8.83418 22.9763 15.1658 22.9763 19.0711 19.071C21.0811 17.061 22.0565 14.4082 21.9975 11.7743C21.9796 10.9772 21.8669 10.1818 21.6595 9.40643C21.0933 9.9488 20.5078 10.4276 19.9163 10.8425C18.5649 11.7906 17.1826 12.4053 15.9301 12.6837C14.0241 13.1072 12.7156 12.7156 12 12C11.2844 11.2844 10.8928 9.97588 11.3163 8.0699C11.5947 6.81738 12.2094 5.43511 13.1575 4.08368C13.5724 3.49221 14.0512 2.90664 14.5935 2.34046C13.8182 2.13305 13.0228 2.02041 12.2256 2.00253ZM17.6569 17.6568C18.9081 16.4056 19.6582 14.8431 19.9072 13.2186C16.3611 15.2643 12.638 15.4664 10.5858 13.4142C8.53361 11.362 8.73568 7.63895 10.7814 4.09281C9.1569 4.34184 7.59434 5.09193 6.34315 6.34313C3.21895 9.46732 3.21895 14.5326 6.34315 17.6568C9.46734 20.781 14.5327 20.781 17.6569 17.6568Z"></path></svg></span></div><div class="toggleTrackX_yM7u"><span class="toggleIcon_kMo0"><svg class="custom-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 18C10.4087 18 8.88258 17.3679 7.75736 16.2426C6.63214 15.1174 6 13.5913 6 12C6 10.4087 6.63214 8.88258 7.75736 7.75736C8.88258 6.63214 10.4087 6 12 6C13.5913 6 15.1174 6.63214 16.2426 7.75736C17.3679 8.88258 18 10.4087 18 12C18 13.5913 17.3679 15.1174 16.2426 16.2426C15.1174 17.3679 13.5913 18 12 18ZM12 16C13.0609 16 14.0783 15.5786 14.8284 14.8284C15.5786 14.0783 16 13.0609 16 12C16 10.9391 15.5786 9.92172 14.8284 9.17157C14.0783 8.42143 13.0609 8 12 8C10.9391 8 9.92172 8.42143 9.17157 9.17157C8.42143 9.92172 8 10.9391 8 12C8 13.0609 8.42143 14.0783 9.17157 14.8284C9.92172 15.5786 10.9391 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.515 4.929L4.929 3.515L7.05 5.636L5.636 7.05L3.515 4.93V4.929ZM16.95 18.364L18.364 16.95L20.485 19.071L19.071 20.485L16.95 18.364ZM19.071 3.514L20.485 4.929L18.364 7.05L16.95 5.636L19.071 3.515V3.514ZM5.636 16.95L7.05 18.364L4.929 20.485L3.515 19.071L5.636 16.95ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z"></path></svg></span></div><div class="toggleTrackThumb_wQGH"></div></div><input type="checkbox" checked="" class="toggleScreenReader_xdqE" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO menuWithAnnouncementBar_x19h"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V1/introduction">What Is Semaphore?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/V1/howitworks">How it works</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V1/quickstart">Quick start</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V1/usage">Usage</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V1/contract-api">Contract API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V1/libsemaphore">libsemaphore</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V1/trustedsetup">Multi-party trusted setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V1/audit">Security audit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/V1/creditsandresources">Credits</a></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Semaphore<!-- --> <b>V1</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/introduction">latest version</a></b> (<!-- -->V2<!-- -->).</div></div><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: <!-- -->V1</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><h1>How it works</h1><h2 class="anchor anchorWithStickyNavbar_mojV" id="inserting-identities">Inserting identities<a class="hash-link" href="#inserting-identities" title="Direct link to heading">â€‹</a></h2><p>An identity is comprised of the following information:</p><ol><li>An <a href="https://en.wikipedia.org/wiki/EdDSA" target="_blank" rel="noopener noreferrer">EdDSA</a> private key. Note that it is
<em>not</em> an Ethereum private key.</li><li>An identity nullifier, whih is a random 32-byte value.</li><li>An identity trapdoor, whih is a random 32-byte value.</li></ol><p>An identity commitment is the Pedersen hash of:</p><ol><li>The public key associated with the identity&#x27;s private key.</li><li>The identity nullifier.</li><li>The identity trapdoor.</li></ol><p>To register an identity, the user must insert their identity commitment into
Semaphore&#x27;s identity tree. They can do this by calling the Semaphore contract&#x27;s
<code>insertIdentity(uint256 _identityCommitment)</code> function. See the <a href="/docs/V1/contract-api">API
reference</a> for more information.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="broadcasting-signals">Broadcasting signals<a class="hash-link" href="#broadcasting-signals" title="Direct link to heading">â€‹</a></h2><p>To broadcast a signal, the user must invoke this Semaphore contract function:</p><div class="codeBlockContainer_I0IT theme-code-block"><div class="codeBlockContent_wNvx"><pre tabindex="0" class="prism-code language-text codeBlock_jd64 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#bfc7d5"><span class="token plain">broadcastSignal(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bytes memory _signal,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256[8] memory _proof,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 _root,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint256 _nullifiersHash,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    uint232 _externalNullifier</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><ul><li><code>_signal</code>: the signal to broadcast.</li><li><code>_proof</code>: a zk-SNARK proof (see below).</li><li><code>_root</code>: The root of the identity tree, where the user&#x27;s identity commitment
is the last-inserted leaf.</li><li><code>_nullifiersHash</code>: A uniquely derived hash of the external nullifier, user&#x27;s
identity nullifier, and the Merkle path index to their identity commitment.
It ensures that a user cannot broadcast a signal with the same external
nullifier more than once.</li><li><code>_externalNullifier</code>: The external nullifier at which the signal is
broadcast.</li></ul><p>To zk-SNARK proof must satisfy the constraints created by Semaphore&#x27;s zk-SNARK
circuit as described below:</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-zk-snark-circuit">The zk-SNARK circuit<a class="hash-link" href="#the-zk-snark-circuit" title="Direct link to heading">â€‹</a></h3><p>The
<a href="https://github.com/appliedzkp/semaphore/blob/master/circuits/circom/semaphore-base.circom" target="_blank" rel="noopener noreferrer">semaphore-base.circom</a>
circuit helps to prove the following:</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="that-the-identity-commitment-exists-in-the-merkle-tree">That the identity commitment exists in the Merkle tree<a class="hash-link" href="#that-the-identity-commitment-exists-in-the-merkle-tree" title="Direct link to heading">â€‹</a></h3><p><strong>Private inputs:</strong></p><ul><li><code>identity_pk</code>: the user&#x27;s EdDSA public key</li><li><code>identity_nullifier</code>: a random 32-byte value which the user should save</li><li><code>identity_trapdoor</code>: a random 32-byte value which the user should save</li><li><code>identity_path_elements</code>: the values along the Merkle path to the
user&#x27;s identity commitment</li><li><code>identity_path_index[n_levels]</code>: the direction (left/right) per tree level
corresponding to the Merkle path to the user&#x27;s identity commitment</li></ul><p><strong>Public inputs:</strong></p><ul><li><code>root</code>: The Merkle root of the identity tree</li></ul><p><strong>Procedure:</strong></p><p>The circuit hashes the public key, identity nullifier, and identity trapdoor to
generate an <strong>identity commitment</strong>. It then verifies the Merkle proof against
the Merkle root and the identity commitment.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="that-the-signal-was-only-broadcasted-once">That the signal was only broadcasted once<a class="hash-link" href="#that-the-signal-was-only-broadcasted-once" title="Direct link to heading">â€‹</a></h3><p><strong>Private inputs:</strong></p><ul><li><code>identity_nullifier</code>: as above</li><li><code>identity_path_index</code>: as above</li></ul><p><strong>Public inputs:</strong></p><ul><li><code>external_nullifier</code>: the 29-byte external nullifier - see above</li><li><code>nullifiers_hash</code>: the hash of the identity nullifier, external nullifier,
and Merkle path index (<code>identity_path_index</code>)</li></ul><p><strong>Procedure:</strong></p><p>The circuit hashes the given identity nullifier, external nullifier, and Merkle
path index, and checks that it matches the given nullifiers hash. Additionally,
the smart contract ensures that it has not previously seen this nullifiers
hash. This way, double-signalling is impossible.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="that-the-signal-was-truly-broadcasted-by-the-user-who-generated-the-proof">That the signal was truly broadcasted by the user who generated the proof<a class="hash-link" href="#that-the-signal-was-truly-broadcasted-by-the-user-who-generated-the-proof" title="Direct link to heading">â€‹</a></h3><p><strong>Private inputs:</strong></p><ul><li><code>identity_pk</code>: as above</li><li><code>auth_sig_r</code>: the <code>r</code> value of the signature of the signal</li><li><code>auth_sig_s</code>: the <code>s</code> value of the signature of the signal</li></ul><p><strong>Public inputs:</strong></p><ul><li><code>signal_hash</code>: the hash of the signal</li><li><code>external_nullifier</code>: the 29-byte external nullifier - see above</li></ul><p><strong>Procedure:</strong></p><p>The circuit hashes the signal hash and the external nullifier, and verifies
this output against the given public key and signature. This ensures the
authenticity of the signal and prevents front-running attacks.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="cryptographic-primitives">Cryptographic primitives<a class="hash-link" href="#cryptographic-primitives" title="Direct link to heading">â€‹</a></h2><p>Semaphore uses MiMC for the Merkle tree, Pedersen commmitments for the identity
commitments, Blake2 for the nullifiers hash, and EdDSA for the signature.</p><p>MiMC is a relatively new hash function. We use the recommended MiMC
construction from <a href="https://eprint.iacr.org/2016/492.pdf" target="_blank" rel="noopener noreferrer">Albrecht et al</a>, and
there is a prize to break MiMC at <a href="http://mimchash.org" target="_blank" rel="noopener noreferrer">http://mimchash.org</a>
which has not been claimed yet.</p><p>We have also implemented a version of Semaphore which uses the Poseidon hash
function for the Merkle tree and EdDSA signature verification. This may have
better security than MiMC, allows identity insertions to save about 20% gas,
and roughly halves the proving time. Note, however, that the Poseidon-related
circuits and EVM bytecode generator have not been audited, so use it with
caution. To use it, checkout the <code>feat/poseidon</code> branch of this repository.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/semaphore-protocol/website/edit/main/versioned_docs/version-V1/howitworks.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_dcUD" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_foO9"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/V1/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">What Is Semaphore?</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/V1/quickstart"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Quick start</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#inserting-identities" class="table-of-contents__link toc-highlight">Inserting identities</a></li><li><a href="#broadcasting-signals" class="table-of-contents__link toc-highlight">Broadcasting signals</a><ul><li><a href="#the-zk-snark-circuit" class="table-of-contents__link toc-highlight">The zk-SNARK circuit</a></li><li><a href="#that-the-identity-commitment-exists-in-the-merkle-tree" class="table-of-contents__link toc-highlight">That the identity commitment exists in the Merkle tree</a></li><li><a href="#that-the-signal-was-only-broadcasted-once" class="table-of-contents__link toc-highlight">That the signal was only broadcasted once</a></li><li><a href="#that-the-signal-was-truly-broadcasted-by-the-user-who-generated-the-proof" class="table-of-contents__link toc-highlight">That the signal was truly broadcasted by the user who generated the proof</a></li></ul></li><li><a href="#cryptographic-primitives" class="table-of-contents__link toc-highlight">Cryptographic primitives</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid container_yWIM"><div><div><h3>About</h3><p>Semaphore is part of Privacy &amp; Scaling Explorations (PSE), a multidisciplinary team supported by the Ethereum Foundation. PSE explores new use cases for zero knowledge proofs and other cryptographic primitives.</p><a href="https://appliedzkp.org" target="_blank" rel="noopener noreferrer">appliedzkp.org</a></div><div><div><h3>Used by</h3><a href="https://github.com/Unirep" target="_blank" rel="noopener noreferrer">Unirep</a><a href="https://interep.link/" target="_blank" rel="noopener noreferrer">Interep</a></div><div><h3>Learn</h3><a href="https://github.com/semaphore-protocol" target="_blank" rel="noopener noreferrer">Github</a><a target="_blank" href="/docs/introduction">Docs</a></div><div><h3>Connect</h3><a href="https://discord.gg/6mSdGHnstH" target="_blank" rel="noopener noreferrer">Discord</a></div></div></div><hr><div><p>Copyright Â© 2022 Ethereum Foundation</p><a style="margin-right:-8px" class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/semaphore-logo.svg" alt="Semaphore Logo" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/semaphore-logo.svg" alt="Semaphore Logo" class="themedImage_W2Cr themedImage--dark_oUvU"></div></a></div></div></footer></div>
<script src="/assets/js/runtime~main.b7f259fa.js"></script>
<script src="/assets/js/main.173807db.js"></script>
</body>
</html>